From f782acb37f7a79d67faa8bd94089bb81e190e3a0 Mon Sep 17 00:00:00 2001
From: Jojojoppe <joppe@blondel.nl>
Date: Sun, 23 Feb 2025 10:54:38 +0000
Subject: [PATCH] ebaz4205: added files

---
 arch/arm/dts/board-ebaz4205.dtsi | 77 +++++++++++++++++++++++++++
 arch/arm/dts/zynq-ebaz4205.dts   |  5 ++
 configs/zynq_ebaz4205_defconfig  | 90 +++++++++++++-------------------
 include/configs/zynq_ebaz4205.h  | 42 +++++++++++++++
 4 files changed, 160 insertions(+), 54 deletions(-)
 create mode 100644 arch/arm/dts/board-ebaz4205.dtsi
 create mode 100644 arch/arm/dts/zynq-ebaz4205.dts
 create mode 100644 include/configs/zynq_ebaz4205.h

diff --git a/arch/arm/dts/board-ebaz4205.dtsi b/arch/arm/dts/board-ebaz4205.dtsi
new file mode 100644
index 0000000000..8acea95c3f
--- /dev/null
+++ b/arch/arm/dts/board-ebaz4205.dtsi
@@ -0,0 +1,77 @@
+/ {
+	chosen {
+		bootargs = "console=ttyPS0,115200 earlyprintk root=/dev/mmcblk0p2 rw";
+		stdout-path = "serial0:115200n8";
+	};
+	
+	aliases {
+		ethernet0 = &gem0;
+		serial0 = &uart1;
+		mmc0 = &sdhci0;
+	};
+	
+	memory@0 {
+		device_type = "memory";
+		reg = <0x0 0x10000000>;
+	};
+	
+	leds {
+		compatible = "gpio-leds";
+		
+		led-green {
+			label = "led-green";
+			gpios = <&gpio0 55 1>;
+			default-state = "off";
+		};
+		led-red {
+			label = "led-red";
+			gpios = <&gpio0 54 1>;
+			default-state = "off";
+		};
+	};
+	
+	buttons {
+		compatible = "gpio-keys-polled";
+		poll-interval = <100>;
+		
+		s2-button {
+			gpios = <&gpio0 20 1>;
+			label = "s2-button";
+			default-state = "keep";
+			linux,code = <106>;
+			autorepeat;
+		};
+		s3-button {
+			gpios = <&gpio0 32 1>;
+			label = "s3-button";
+			default-state = "keep";
+			linux,code = <105>;
+			autorepeat;
+		};
+	};
+};
+
+&uart1 {
+	u-boot,dm-pre-reloc;
+	status = "okay";
+};
+
+&gem0 {
+	status = "okay";
+	phy-mode = "rgmii-id";
+	phy-handle = <&ethernet_phy0>;
+	
+	ethernet_phy0: ethernet-phy@0 {
+		reg = <0>;
+		device_type = "ethernet-phy";
+	};
+};
+
+&sdhci0 {
+	u-boot,dm-pre-reloc;
+	status = "okay";
+};
+
+&gpio0 {
+	gpio-mask-low = <0x5600>;
+};
\ No newline at end of file
diff --git a/arch/arm/dts/zynq-ebaz4205.dts b/arch/arm/dts/zynq-ebaz4205.dts
new file mode 100644
index 0000000000..bf50c81eac
--- /dev/null
+++ b/arch/arm/dts/zynq-ebaz4205.dts
@@ -0,0 +1,5 @@
+/dts-v1/;
+/include/ "zynq-7000.dtsi"
+/include/ "board-ebaz4205.dtsi"
+/ {
+};
\ No newline at end of file
diff --git a/configs/zynq_ebaz4205_defconfig b/configs/zynq_ebaz4205_defconfig
index 1333b5a7c3..e0db633adb 100644
--- /dev/null
+++ b/configs/zynq_ebaz4205_defconfig
@@ -1,61 +1,43 @@
+CONFIG_ARM=y
+CONFIG_SYS_CONFIG_NAME="zynq_ebaz4205"
+CONFIG_SKIP_LOWLEVEL_INIT=y
+CONFIG_SPL_SKIP_LOWLEVEL_INIT=y
+CONFIG_SYS_ICACHE_OFF=y
+CONFIG_SYS_DCACHE_OFF=y
+CONFIG_SYS_L2CACHE_OFF=y
+CONFIG_ARCH_ZYNQ=y
+CONFIG_TEXT_BASE=0x4000000
+CONFIG_SYS_MALLOC_LEN=0x8000
+CONFIG_ENV_SIZE=0x190
+CONFIG_DEFAULT_DEVICE_TREE="zynq-ebaz4205"
+CONFIG_SPL_STACK_R_ADDR=0x200000
+CONFIG_SPL_STACK=0xfffffe00
+CONFIG_SPL=y
+CONFIG_SYS_LOAD_ADDR=0x0
+CONFIG_REMAKE_ELF=y
+CONFIG_SYS_CUSTOM_LDSCRIPT=y
+CONFIG_SYS_LDSCRIPT="arch/arm/mach-zynq/u-boot.lds"
+CONFIG_USE_PREBOOT=y
+CONFIG_CLOCKS=y
+CONFIG_SPL_MAX_SIZE=0x30000
+CONFIG_SPL_HAS_BSS_LINKER_SECTION=y
+CONFIG_SPL_BSS_START_ADDR=0x20000
+CONFIG_SPL_BSS_MAX_SIZE=0x8000
+CONFIG_SPL_STACK_R=y
+CONFIG_SPL_SYS_MALLOC=y
+CONFIG_SPL_HAS_CUSTOM_MALLOC_START=y
+CONFIG_SPL_CUSTOM_SYS_MALLOC_ADDR=0x200000
+CONFIG_SPL_SYS_MALLOC_SIZE=0x2000000
+CONFIG_SYS_MAXARGS=32
+CONFIG_SYS_CBSIZE=1024
+CONFIG_SYS_PBSIZE=1047
+CONFIG_OF_EMBED=y
+CONFIG_ENV_OVERWRITE=y
+CONFIG_SYS_RELOC_GD_ENV_ADDR=y
+CONFIG_SPL_DM_SEQ_ALIAS=y
+CONFIG_MTD=y
+CONFIG_MTD_RAW_NAND=y
+CONFIG_NAND_ZYNQ=y
+CONFIG_SYS_NAND_ONFI_DETECTION=y
+CONFIG_ARM_DCC=y
+CONFIG_SYS_TIMER_COUNTS_DOWN=y
diff --git a/include/configs/zynq_ebaz4205.h b/include/configs/zynq_ebaz4205.h
new file mode 100644
index 0000000000..8d7403cd59
--- /dev/null
+++ b/include/configs/zynq_ebaz4205.h
@@ -0,0 +1,42 @@
+/* SPDX-License-Identifier: GPL-2.0+ */
+/*
+ * (C) Copyright 2020 embed-me
+ *
+ * Configuration settings for the EBAZ4205 Board
+ * See zynq-common.h for Zynq common configs
+ */
+
+#ifndef __CONFIG_ZYNQ_EBAZ4205_H
+#define __CONFIG_ZYNQ_EBAZ4205_H
+
+
+/* Configuration for zynq-common.h */
+//#define CONFIG_ZYNQ_GEM
+//#define CONFIG_CMD_DHCP
+#include <configs/zynq-common.h>
+
+#undef CONFIG_EXTRA_ENV_SETTINGS
+#define CONFIG_EXTRA_ENV_SETTINGS \
+	"load_addr=0x2000000\0"		\
+	"loadbootenv_addr=0x2000000\0" \
+	"bootenv=uEnv.txt\0" \
+	"bootenv_dev=mmc\0" \
+	"loadbootenv=load ${bootenv_dev} 0 ${loadbootenv_addr} ${bootenv}\0" \
+	"importbootenv=echo Importing environment from ${bootenv_dev} ...; " \
+		"env import -t ${loadbootenv_addr} $filesize\0" \
+	"bootenv_existence_test=test -e ${bootenv_dev} 0 /${bootenv}\0" \
+	"setbootenv=if env run bootenv_existence_test; then " \
+			"if env run loadbootenv; then " \
+				"env run importbootenv; " \
+			"fi; " \
+		"fi; \0" \
+	"sd_loadbootenv=setenv bootenv_dev mmc && " \
+			"run setbootenv \0" \
+	"preboot=run sd_loadbootenv; " \
+			"echo Checking if uenvcmd is set ...; " \
+			"if test -n $uenvcmd; then " \
+				"echo Running uenvcmd ...; " \
+				"run uenvcmd; " \
+			"fi; \0"
+
+#endif /* __CONFIG_ZYNQ_EBAZ4205_H */
\ No newline at end of file
